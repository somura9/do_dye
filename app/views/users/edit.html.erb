<h1>プロフィール設定</h1>
<%= form_with model: @user, local: true do |f| %>
  <div class="form-group">
    <!------ 画像の添付 ------>
    <%= f.label :avatar, class: "form-label" %><br>
    <%= f.file_field :avatar, onchange: "avatarImage(this);", class: "mb-3" %>
    <!------ 添付画像のプレビューを表示 ------>
    <div id="avatar" >
      <img id="avatar_preview" class="mb-3" width="100">
    </div>
    <!------ 現在DBに登録(保存)されている画像を表示 ------>
    <% if @user.avatar.present? %> <!-- @user.avatarが存在する場合のみ image_tag を使用(if文ないとエラーが出る) -->
      <span><b>[現在登録されている画像]</b></span>
      <%= image_tag @user.avatar_url, width: 200, class: "mb-2" %>
    <% end %>
  </div>
  <div class="form-group">
    <%= f.label :name %>
    <%= f.text_field :name, class: 'form-control' %>
  </div>
  <div class="form-group">
    <%= f.label :bio %>
    <%= f.text_area :bio, class: 'form-control' %>
  </div>


  <%= f.submit class: 'btn btn-primary' %>
<% end %>


<!------ プレビュー表示用の JavaScript ------->
<script>
  function avatarImage(obj){
      var fileReader = new FileReader();
      fileReader.onload = (function() {
        document.getElementById('avatar_preview').src = fileReader.result;
      });
      fileReader.readAsDataURL(obj.files[0]);
  }
</script>